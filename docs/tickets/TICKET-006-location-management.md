# TICKET-006: ãƒã‚¹ã‚¿ç®¡ç†æ©Ÿèƒ½ - é…å±ç®‡æ‰€ç®¡ç†

## ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
ğŸ“‹ æœªç€æ‰‹

## å„ªå…ˆåº¦
â­â­â­â­â­ æœ€é«˜

## è¤‡é›‘åº¦
Complex

## æ¦‚è¦
é…å±ç®‡æ‰€ã¨è¦ä»¶è¨­å®šã®CRUDæ©Ÿèƒ½å®Ÿè£…

## æˆæœç‰©
- [x] `/app/locations/page.tsx` - é…å±ç®‡æ‰€ä¸€è¦§ãƒšãƒ¼ã‚¸
- [x] `/app/locations/new/page.tsx` - é…å±ç®‡æ‰€è¿½åŠ ãƒšãƒ¼ã‚¸
- [x] `/app/locations/[id]/edit/page.tsx` - é…å±ç®‡æ‰€ç·¨é›†ãƒšãƒ¼ã‚¸
- [x] `/app/locations/[id]/requirements/page.tsx` - è¦ä»¶è¨­å®šãƒšãƒ¼ã‚¸
- [x] `/lib/actions/locations.ts` - Server Actions
- [x] `/lib/actions/location-requirements.ts` - è¦ä»¶ã®Server Actions
- [x] `/components/locations/` - é–¢é€£ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
  - `LocationTable.tsx` - ä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ«
  - `LocationForm.tsx` - é…å±ç®‡æ‰€ãƒ•ã‚©ãƒ¼ãƒ 
  - `RequirementForm.tsx` - è¦ä»¶è¨­å®šãƒ•ã‚©ãƒ¼ãƒ 
  - `RequirementList.tsx` - è¦ä»¶ä¸€è¦§

## ä¾å­˜é–¢ä¿‚
- TICKET-002: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒæ§‹ç¯‰
- TICKET-003: å½¹è·ãƒ»ã‚¿ã‚°ç®¡ç†
- TICKET-004: å‹¤å‹™è¨˜å·ç®¡ç†

## æ©Ÿèƒ½è¦ä»¶

### é…å±ç®‡æ‰€ä¸€è¦§
- è¡¨ç¤ºé …ç›®
  - æ¥­å‹™ç¨®åˆ¥
  - é…å±ç®‡æ‰€å
  - ã‚³ãƒ¼ãƒ‰
  - ä½¿ç”¨çŠ¶æ³
  - è¦ä»¶è¨­å®šæ•°
- ã‚«ãƒ†ã‚´ãƒªåˆ¥ãƒ•ã‚£ãƒ«ã‚¿
  - ä¿å®‰æ¤œæŸ»å ´æ¡ˆå†…æ¥­å‹™
  - ãƒã‚¹æ¡ˆå†…æ¥­å‹™
  - æ¨ªç‰¹æ¥­å‹™
- ã‚½ãƒ¼ãƒˆæ©Ÿèƒ½

### é…å±ç®‡æ‰€è¿½åŠ 
- å…¥åŠ›é …ç›®
  - æ¥­å‹™ç¨®åˆ¥ï¼ˆé¸æŠï¼‰
  - é…å±ç®‡æ‰€åï¼ˆä¾‹: T3ä¸­å¤®ï¼‰
  - ã‚³ãƒ¼ãƒ‰ï¼ˆä¾‹: T3Cã€é‡è¤‡ãƒã‚§ãƒƒã‚¯ï¼‰
  - ä½¿ç”¨çŠ¶æ³ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ä½¿ç”¨ä¸­ï¼‰

### é…å±ç®‡æ‰€ç·¨é›†
- æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ç·¨é›†
- ã‚³ãƒ¼ãƒ‰ã¯ç·¨é›†ä¸å¯

### é…å±ç®‡æ‰€è¦ä»¶è¨­å®šï¼ˆé‡è¦ï¼ï¼‰

ã“ã®æ©Ÿèƒ½ãŒæœ€ã‚‚è¤‡é›‘ãªéƒ¨åˆ†ã§ã™ã€‚

#### è¦ä»¶è¨­å®šã®ç¨®é¡
1. **æ›œæ—¥ãƒ‘ã‚¿ãƒ¼ãƒ³è¦ä»¶**
   - ä¾‹: æ¯é€±æœˆæ›œæ—¥ã¯T3ä¸­å¤®ã«5åå¿…è¦
   - day_of_week: 0-6ï¼ˆæ—¥-åœŸï¼‰

2. **ç‰¹å®šæ—¥è¦ä»¶**
   - ä¾‹: 2025-12-25ã¯T3ä¸­å¤®ã«10åå¿…è¦
   - specific_date: YYYY-MM-DD

3. **ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¦ä»¶**
   - æ›œæ—¥ãƒ»ç‰¹å®šæ—¥ã®æŒ‡å®šãªã—
   - day_of_week: null, specific_date: null

#### è¦ä»¶è¨­å®šé …ç›®
- é…å±ç®‡æ‰€ï¼ˆè¦ªï¼‰
- å‹¤å‹™è¨˜å·ï¼ˆãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ï¼‰
- å¿…è¦äººæ•°ï¼ˆæ•°å€¤ï¼‰
- å¿…è¦è²¬ä»»è€…æ•°ï¼ˆæ•°å€¤ï¼‰
- å¿…è¦ã‚¿ã‚°ï¼ˆè¤‡æ•°é¸æŠï¼‰
- é©ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³
  - [ ] ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
  - [ ] æ›œæ—¥æŒ‡å®š: [æœˆâ–¼]
  - [ ] ç‰¹å®šæ—¥æŒ‡å®š: [2025-12-25]

### è¦ä»¶ä¸€è¦§ï¼ˆé…å±ç®‡æ‰€ã”ã¨ï¼‰
- é…å±ç®‡æ‰€ã«ç´ã¥ãè¦ä»¶ã‚’ä¸€è¦§è¡¨ç¤º
- å‹¤å‹™è¨˜å·åˆ¥ã«ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°
- é©ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³åˆ¥ã«è¡¨ç¤º

## UIè¨­è¨ˆ

### é…å±ç®‡æ‰€ä¸€è¦§
```
+--------------------------------------------------+
| [æ–°è¦é…å±ç®‡æ‰€è¿½åŠ ]                                 |
+--------------------------------------------------+
| æ¥­å‹™ç¨®åˆ¥ | é…å±ç®‡æ‰€å | ã‚³ãƒ¼ãƒ‰ | è¦ä»¶æ•° | æ“ä½œ     |
+--------------------------------------------------+
| ä¿å®‰æ¤œæŸ» | T3ä¸­å¤® | T3C | 5 | [ç·¨é›†][è¦ä»¶è¨­å®š][å‰Šé™¤] |
| ãƒã‚¹æ¡ˆå†… | ãƒã‚¹æ¡ˆå†… | BUS | 3 | [ç·¨é›†][è¦ä»¶è¨­å®š][å‰Šé™¤] |
+--------------------------------------------------+
```

### è¦ä»¶è¨­å®šç”»é¢
```
+--------------------------------------------------+
| é…å±ç®‡æ‰€: T3ä¸­å¤® ã®è¦ä»¶è¨­å®š                         |
+--------------------------------------------------+
| [æ–°è¦è¦ä»¶è¿½åŠ ]                                     |
+--------------------------------------------------+
| å‹¤å‹™è¨˜å· | äººæ•° | è²¬ä»»è€… | ã‚¿ã‚° | ãƒ‘ã‚¿ãƒ¼ãƒ³ | æ“ä½œ |
+--------------------------------------------------+
| 06G5DA | 5å | 1å | ä¿å®‰æ¤œæŸ» | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | [ç·¨é›†][å‰Šé™¤] |
| 06G5DA | 8å | 2å | ä¿å®‰æ¤œæŸ» | æœˆæ›œ | [ç·¨é›†][å‰Šé™¤] |
| 18A5AA | 3å | 1å | ä¿å®‰æ¤œæŸ» | 12/25 | [ç·¨é›†][å‰Šé™¤] |
+--------------------------------------------------+
```

### è¦ä»¶è¿½åŠ ãƒ•ã‚©ãƒ¼ãƒ 
```
+--------------------------------------------------+
| è¦ä»¶è¨­å®šè¿½åŠ                                        |
+--------------------------------------------------+
| å‹¤å‹™è¨˜å·: [06G5DA â–¼]                              |
| å¿…è¦äººæ•°: [5] å                                   |
| å¿…è¦è²¬ä»»è€…æ•°: [1] å                               |
| å¿…è¦ã‚¿ã‚°: [â˜‘ä¿å®‰æ¤œæŸ»] [â˜ãƒã‚¹æ¡ˆå†…]                 |
|                                                  |
| é©ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³:                                      |
| âš« ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ                                      |
| â—‹ æ›œæ—¥æŒ‡å®š: [æœˆæ›œ â–¼]                              |
| â—‹ ç‰¹å®šæ—¥æŒ‡å®š: [2025-12-25]                        |
|                                                  |
| [ã‚­ãƒ£ãƒ³ã‚»ãƒ«] [ä¿å­˜]                                |
+--------------------------------------------------+
```

## ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ä¾‹

### location_requirements ãƒ†ãƒ¼ãƒ–ãƒ«
```
id | location_id | duty_code_id | required_staff_count | required_responsible_count | required_tags | day_of_week | specific_date
---|-------------|--------------|---------------------|---------------------------|---------------|-------------|---------------
1  | uuid-1      | uuid-A       | 5                   | 1                         | ['ä¿å®‰æ¤œæŸ»']   | null        | null
2  | uuid-1      | uuid-A       | 8                   | 2                         | ['ä¿å®‰æ¤œæŸ»']   | 1 (æœˆæ›œ)    | null
3  | uuid-1      | uuid-B       | 3                   | 1                         | ['ä¿å®‰æ¤œæŸ»']   | null        | 2025-12-25
```

## ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
- æ¥­å‹™ç¨®åˆ¥: å¿…é ˆ
- é…å±ç®‡æ‰€å: å¿…é ˆã€1-50æ–‡å­—
- ã‚³ãƒ¼ãƒ‰: å¿…é ˆã€1-10æ–‡å­—ã€é‡è¤‡ä¸å¯
- å¿…è¦äººæ•°: å¿…é ˆã€1-100ã®æ•°å€¤
- å¿…è¦è²¬ä»»è€…æ•°: 0-10ã®æ•°å€¤
- day_of_weekã¨specific_dateã¯æ’ä»–çš„ï¼ˆä¸¡æ–¹nullã¾ãŸã¯ã©ã¡ã‚‰ã‹ä¸€æ–¹ã®ã¿ï¼‰

## Server Actionså®Ÿè£…ä¾‹

```typescript
'use server'

import { createClient } from '@/lib/supabase/server'

export async function getLocationRequirements(locationId: string) {
  const supabase = await createClient()

  const { data, error } = await supabase
    .from('location_requirements')
    .select(`
      *,
      duty_codes (
        code,
        start_time,
        end_time,
        category
      )
    `)
    .eq('location_id', locationId)
    .order('duty_code_id')

  if (error) throw error
  return data
}

export async function createLocationRequirement(formData: FormData) {
  const supabase = await createClient()

  const patternType = formData.get('pattern_type') as string
  const requirement = {
    location_id: formData.get('location_id') as string,
    duty_code_id: formData.get('duty_code_id') as string,
    required_staff_count: parseInt(formData.get('required_staff_count') as string),
    required_responsible_count: parseInt(formData.get('required_responsible_count') as string),
    required_tags: formData.getAll('required_tags') as string[],
    day_of_week: patternType === 'day_of_week' ? parseInt(formData.get('day_of_week') as string) : null,
    specific_date: patternType === 'specific_date' ? formData.get('specific_date') as string : null,
  }

  const { error } = await supabase.from('location_requirements').insert(requirement)

  if (error) throw error

  revalidatePath(`/locations/${requirement.location_id}/requirements`)
}
```

## ãƒ†ã‚¹ãƒˆé …ç›®
- [ ] é…å±ç®‡æ‰€ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] é…å±ç®‡æ‰€ã®è¿½åŠ ãŒã§ãã‚‹
- [ ] é…å±ç®‡æ‰€ã®ç·¨é›†ãŒã§ãã‚‹
- [ ] é…å±ç®‡æ‰€ã®å‰Šé™¤ãŒã§ãã‚‹
- [ ] è¦ä»¶è¨­å®šç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¦ä»¶ã®è¿½åŠ ãŒã§ãã‚‹
- [ ] æ›œæ—¥ãƒ‘ã‚¿ãƒ¼ãƒ³è¦ä»¶ã®è¿½åŠ ãŒã§ãã‚‹
- [ ] ç‰¹å®šæ—¥è¦ä»¶ã®è¿½åŠ ãŒã§ãã‚‹
- [ ] è¦ä»¶ã®ç·¨é›†ãŒã§ãã‚‹
- [ ] è¦ä»¶ã®å‰Šé™¤ãŒã§ãã‚‹
- [ ] å¿…è¦ã‚¿ã‚°ã®è¤‡æ•°é¸æŠãŒã§ãã‚‹
- [ ] ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ©Ÿèƒ½ã™ã‚‹

## æ³¨æ„äº‹é …
- UIãŒè¤‡é›‘ã«ãªã‚‹ãŸã‚ã€æ®µéšçš„ã«å®Ÿè£…
- ã¾ãšã¯é…å±ç®‡æ‰€CRUDã€æ¬¡ã«è¦ä»¶è¨­å®š
- è¦ä»¶è¨­å®šã¯åˆ¥ãƒšãƒ¼ã‚¸ã¾ãŸã¯ãƒ¢ãƒ¼ãƒ€ãƒ«ã§å®Ÿè£…

## å®Œäº†æ¡ä»¶
- [ ] é…å±ç®‡æ‰€ã®CRUDæ©Ÿèƒ½ãŒå…¨ã¦å‹•ä½œã™ã‚‹
- [ ] è¦ä»¶è¨­å®šã®CRUDæ©Ÿèƒ½ãŒå…¨ã¦å‹•ä½œã™ã‚‹
- [ ] 3ç¨®é¡ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã€æ›œæ—¥ã€ç‰¹å®šæ—¥ï¼‰ãŒæ­£ã—ãå‹•ä½œã™ã‚‹
- [ ] UI/UXãŒç›´æ„Ÿçš„

## è¦‹ç©ã‚‚ã‚Šå·¥æ•°
12-16æ™‚é–“

## é–‹å§‹äºˆå®šæ—¥
2025-11-17

## å®Œäº†äºˆå®šæ—¥
2025-11-19
