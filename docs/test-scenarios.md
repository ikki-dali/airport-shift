# テストシナリオドキュメント

## 概要
このドキュメントでは、空港シフト管理システムの主要機能のテストシナリオを記載します。

## テスト環境の準備

### 1. シードデータの投入
1. ブラウザで `http://localhost:3000/admin/seed` にアクセス
2. 「既存データをクリア」にチェック（初回テストの場合）
3. 「シードデータを投入」ボタンをクリック
4. 投入完了メッセージを確認

**期待結果:**
- 役職: 4件
- タグ: 5件
- 勤務記号: 28件
- 配属箇所: 5件
- スタッフ: 15名
- スタッフタグ: 約20件
- 配属箇所要件: 6件
- シフト希望: 約100件（2025年12月分）

---

## 1. マスタ管理のテスト

### 1.1 役職管理
**テストURL:** `/roles`

#### TC-1.1.1: 役職一覧の表示
1. 役職管理画面にアクセス
2. 一覧が表示されることを確認

**期待結果:**
- 一般社員、サブリーダー、リーダー、管理者が表示される
- 各役職の優先度と責任者フラグが正しく表示される

#### TC-1.1.2: 役職の追加
1. 「新規追加」ボタンをクリック
2. 役職名「アシスタントリーダー」を入力
3. 優先度「2.5」、責任者フラグ「はい」を選択
4. 保存ボタンをクリック

**期待結果:**
- 新しい役職が一覧に追加される
- 優先度順に並び替えられる

#### TC-1.1.3: 役職の編集
1. 既存の役職の編集ボタンをクリック
2. 役職名を変更
3. 保存ボタンをクリック

**期待結果:**
- 変更が反映される
- 一覧が更新される

#### TC-1.1.4: 役職の削除
1. 使用されていない役職の削除ボタンをクリック
2. 確認ダイアログで「削除」を選択

**期待結果:**
- 役職が削除される
- 使用中の役職は削除できない旨のエラーが表示される（該当する場合）

---

### 1.2 タグ管理
**テストURL:** `/tags`

#### TC-1.2.1: タグ一覧の表示
1. タグ管理画面にアクセス
2. 一覧が表示されることを確認

**期待結果:**
- 保安検査、バス案内、横特、OSS、番台が表示される
- 各タグの説明が表示される

#### TC-1.2.2: タグの追加
1. 「新規追加」ボタンをクリック
2. タグ名「グランドスタッフ」を入力
3. 説明を入力
4. 保存ボタンをクリック

**期待結果:**
- 新しいタグが一覧に追加される

#### TC-1.2.3: タグの編集・削除
1. タグの編集・削除を実行
2. 正常に動作することを確認

**期待結果:**
- 編集・削除が正常に動作する

---

### 1.3 勤務記号管理
**テストURL:** `/duty-codes`

#### TC-1.3.1: 勤務記号一覧の表示
1. 勤務記号管理画面にアクセス
2. 一覧が表示されることを確認

**期待結果:**
- 28件の勤務記号が表示される
- 勤務記号、開始時刻、終了時刻、時間が正しく表示される

#### TC-1.3.2: 勤務記号のフィルタリング
1. カテゴリフィルタを使用
2. 特定カテゴリの勤務記号のみが表示されることを確認

**期待結果:**
- フィルタが正しく機能する
- 該当する勤務記号のみが表示される

---

### 1.4 スタッフ管理
**テストURL:** `/staff`

#### TC-1.4.1: スタッフ一覧の表示
1. スタッフ管理画面にアクセス
2. 一覧が表示されることを確認

**期待結果:**
- 15名のスタッフが表示される
- 社員番号、氏名、メール、役職、タグが表示される

#### TC-1.4.2: スタッフの追加
1. 「新規追加」ボタンをクリック
2. 必要情報を入力（社員番号、氏名、メール、役職、タグ）
3. 保存ボタンをクリック

**期待結果:**
- 新しいスタッフが一覧に追加される
- タグが正しく関連付けられる

#### TC-1.4.3: スタッフの編集
1. スタッフの編集ボタンをクリック
2. 役職やタグを変更
3. 保存ボタンをクリック

**期待結果:**
- 変更が反映される
- シフト作成画面にも変更が反映される

#### TC-1.4.4: スタッフの削除
1. スタッフの削除ボタンをクリック
2. 確認ダイアログで「削除」を選択

**期待結果:**
- スタッフが削除される
- シフトが割り当てられているスタッフは削除できない旨のエラーが表示される（該当する場合）

---

### 1.5 配属箇所管理
**テストURL:** `/locations`

#### TC-1.5.1: 配属箇所一覧の表示
1. 配属箇所管理画面にアクセス
2. 一覧が表示されることを確認

**期待結果:**
- 5件の配属箇所が表示される
- 業務種別、配属箇所名、コードが表示される

#### TC-1.5.2: 配属箇所の追加
1. 「新規追加」ボタンをクリック
2. 必要情報を入力
3. 保存ボタンをクリック

**期待結果:**
- 新しい配属箇所が一覧に追加される

#### TC-1.5.3: 配属箇所要件の設定
1. 配属箇所の「要件設定」ボタンをクリック
2. 勤務記号を選択
3. 必要人数、責任者数、必要タグを設定
4. 曜日別の設定（オプション）
5. 保存ボタンをクリック

**期待結果:**
- 要件が保存される
- シフト作成時の制約チェックに反映される

---

## 2. 希望提出管理のテスト

### 2.1 希望データの表示
**テストURL:** `/requests/2025-12`

#### TC-2.1.1: カレンダー表示
1. 希望データ画面にアクセス
2. 表示モード「カレンダー」を選択

**期待結果:**
- カレンダー形式で希望が表示される
- 日付ごとにスタッフの希望が色分けされて表示される
- 日曜日は赤、土曜日は青の背景色になる

#### TC-2.1.2: テーブル表示
1. 表示モード「テーブル」を選択

**期待結果:**
- スタッフ × 日付のマトリックス形式で表示される
- 各セルに希望タイプが表示される
- スタッフ列が固定される（スクロール時）

#### TC-2.1.3: スタッフフィルタ
1. フィルターを展開
2. 特定のスタッフを選択

**期待結果:**
- 選択したスタッフの希望のみが表示される
- フィルター数がバッジに表示される

#### TC-2.1.4: 希望タイプフィルタ
1. フィルターを展開
2. 特定の希望タイプ（例: 休）を選択

**期待結果:**
- 選択した希望タイプのみが表示される
- 複数選択可能

#### TC-2.1.5: フィルタクリア
1. フィルタを適用した状態で「クリア」ボタンをクリック

**期待結果:**
- すべてのフィルタがクリアされる
- 全データが表示される

---

### 2.2 Excelファイルの取り込み
**テストURL:** `/requests/import`

#### TC-2.2.1: Excelファイルのアップロード
1. 希望データインポート画面にアクセス
2. 年月を選択（例: 2025-12）
3. Excelファイルを選択
4. 「アップロード」ボタンをクリック

**期待結果:**
- ファイルが正常に読み込まれる
- プレビューが表示される

#### TC-2.2.2: データの確認と投入
1. プレビューでデータを確認
2. 「投入」ボタンをクリック

**期待結果:**
- データがデータベースに保存される
- 希望データ一覧に反映される

#### TC-2.2.3: エラーハンドリング
1. 不正なフォーマットのExcelファイルをアップロード

**期待結果:**
- エラーメッセージが表示される
- データは投入されない

---

## 3. シフト作成のテスト

### 3.1 シフト作成画面
**テストURL:** `/shifts/create?yearMonth=2025-12&date=2025-12-01`

#### TC-3.1.1: 画面の表示
1. シフト作成画面にアクセス
2. レイアウトを確認

**期待結果:**
- 左側: スタッフリスト
- 中央: カレンダーまたはリスト表示
- 右側: 日付選択時の希望パネル

#### TC-3.1.2: スタッフフィルタリング
1. 検索ボックスに「山田」と入力

**期待結果:**
- 「山田太郎」のみが表示される

2. 役職フィルタで「リーダー」を選択

**期待結果:**
- リーダーのスタッフのみが表示される

3. タグフィルタで「保安検査」を選択

**期待結果:**
- 保安検査タグを持つスタッフのみが表示される

---

### 3.2 ドラッグ&ドロップ操作

#### TC-3.2.1: スタッフをシフトに配置
1. スタッフリストからスタッフをドラッグ
2. カレンダーの特定日付・配属箇所・勤務記号にドロップ

**期待結果:**
- シフトが作成される
- スタッフ名が表示される
- 制約チェックが実行される

#### TC-3.2.2: シフトの移動
1. 配置済みのシフトをドラッグ
2. 別の日付・配属箇所・勤務記号にドロップ

**期待結果:**
- シフトが移動する
- 制約チェックが実行される

#### TC-3.2.3: シフトの削除
1. 配置済みのシフトをクリック
2. 削除ボタンをクリック

**期待結果:**
- シフトが削除される

---

### 3.3 日付選択と希望パネル

#### TC-3.3.1: 日付の選択
1. カレンダーまたはリスト表示で日付をクリック

**期待結果:**
- 右側に希望パネルが表示される
- 選択した日付の希望が表示される

#### TC-3.3.2: 希望からのドラッグ
1. 希望パネルからスタッフをドラッグ
2. カレンダーにドロップ

**期待結果:**
- シフトが作成される
- 希望内容が考慮される

---

## 4. 制約チェックのテスト

### 4.1 必要人数チェック

#### TC-4.1.1: 人数不足の検出
1. T3中央・06G5DA（必要人数5名）に3名のみ配置

**期待結果:**
- エラー表示: 「必要人数5名に対して3名しか配置されていません」
- 保存が制限される

#### TC-4.1.2: 人数充足の確認
1. 必要人数を満たすようにスタッフを配置

**期待結果:**
- エラーが消える
- 保存が可能になる

---

### 4.2 責任者チェック

#### TC-4.2.1: 責任者不足の検出
1. T3中央・06G5DA（責任者1名必要）に一般社員のみ配置

**期待結果:**
- エラー表示: 「責任者が1名必要ですが、0名しか配置されていません」

#### TC-4.2.2: 責任者配置の確認
1. リーダーまたはサブリーダーを配置

**期待結果:**
- エラーが消える

---

### 4.3 必要タグチェック

#### TC-4.3.1: タグ不足の検出
1. 保安検査タグが必要な箇所にバス案内タグのみのスタッフを配置

**期待結果:**
- 警告表示: 「保安検査タグを持つスタッフが必要です」

#### TC-4.3.2: タグ充足の確認
1. 必要タグを持つスタッフを配置

**期待結果:**
- 警告が消える

---

### 4.4 重複チェック

#### TC-4.4.1: 同一スタッフの重複配置
1. 同じスタッフを同じ日の異なる勤務記号に配置

**期待結果:**
- エラー表示: 「同じ日に複数のシフトが割り当てられています」

---

### 4.5 夜勤明けチェック

#### TC-4.5.1: 夜勤翌日の配置
1. 12月1日にスタッフを夜勤（19:00以降開始）に配置
2. 12月2日に同じスタッフを早番に配置

**期待結果:**
- 警告表示: 「夜勤明けのスタッフです」

---

### 4.6 連続勤務チェック

#### TC-4.6.1: 7日連続勤務の検出
1. 同じスタッフを7日連続でシフトに配置

**期待結果:**
- 警告表示: 「連続勤務が7日になります（上限: 6日）」

---

## 5. シフト確定のテスト

### 5.1 個別確定
**テストURL:** `/shifts/list`

#### TC-5.1.1: シフトの確定
1. シフト一覧画面にアクセス
2. 未確定のシフトの「確定」ボタンをクリック

**期待結果:**
- シフトが確定状態になる
- 確定マークが表示される
- 確定後の編集が制限される

#### TC-5.1.2: 確定解除
1. 確定済みシフトの「確定解除」ボタンをクリック

**期待結果:**
- シフトが未確定状態に戻る
- 編集が可能になる

---

### 5.2 一括確定

#### TC-5.2.1: 月単位の一括確定
1. 「一括確定」ボタンをクリック
2. 確認ダイアログで「確定」を選択

**期待結果:**
- 対象のシフトがすべて確定される
- 制約違反があるシフトは確定できない旨の警告が表示される

---

## 6. 出力機能のテスト

### 6.1 Excel出力
**テストURL:** `/shifts/list`

#### TC-6.1.1: Excelエクスポート
1. シフト一覧画面で「Excelエクスポート」ボタンをクリック

**期待結果:**
- Excelファイルがダウンロードされる
- ファイルを開いて内容を確認
- スタッフ × 日付のマトリックス形式
- 勤務記号が正しく表示される

---

### 6.2 CSV出力

#### TC-6.2.1: CSVエクスポート
1. シフト一覧画面で「CSVエクスポート」ボタンをクリック

**期待結果:**
- CSVファイルがダウンロードされる
- ファイルを開いて内容を確認
- 日付、スタッフ、配属箇所、勤務記号が正しく表示される

---

## 7. 履歴管理のテスト

### 7.1 作成者・更新者の記録

#### TC-7.1.1: シフト作成時
1. 新しいシフトを作成
2. データベースを確認（または詳細画面）

**期待結果:**
- created_by に現在のユーザーIDが記録される
- updated_by に現在のユーザーIDが記録される
- created_at に現在日時が記録される
- updated_at に現在日時が記録される

#### TC-7.1.2: シフト更新時
1. 既存のシフトを編集
2. データベースを確認

**期待結果:**
- updated_by が更新される
- updated_at が更新される
- created_by は変更されない

#### TC-7.1.3: シフト確定時
1. シフトを確定
2. データベースを確認

**期待結果:**
- updated_by が更新される
- updated_at が更新される

---

## 8. パフォーマンステスト

### 8.1 大量データでの動作確認

#### TC-8.1.1: 150名のスタッフ
1. スタッフを150名に増やす
2. シフト作成画面にアクセス

**期待結果:**
- スタッフリストが正常に表示される
- フィルタリングが快適に動作する
- レスポンスタイムが3秒以内

#### TC-8.1.2: 1ヶ月分（約1000件）のシフト
1. 1ヶ月分のシフトを作成（約1000件）
2. シフト一覧画面にアクセス

**期待結果:**
- 一覧が正常に表示される
- ページネーションが機能する
- レスポンスタイムが5秒以内

#### TC-8.1.3: Excel/CSVエクスポート
1. 大量データをエクスポート

**期待結果:**
- エクスポートが完了する
- ファイルサイズが適切
- メモリエラーが発生しない

---

## テスト完了条件

- [ ] 全てのマスタデータが正しく管理できる
- [ ] 希望データの表示・フィルタリングが正常に動作する
- [ ] Excelインポートが正常に動作する
- [ ] シフト作成のドラッグ&ドロップが正常に動作する
- [ ] 全ての制約チェックが正しく機能する
- [ ] シフト確定・確定解除が正常に動作する
- [ ] Excel/CSVエクスポートが正常に動作する
- [ ] 履歴管理が正常に動作する
- [ ] パフォーマンスが良好（150名、1000件のシフト）
- [ ] クリティカルなバグがゼロ

---

## バグ管理

テスト実行中に発見したバグは、以下のフォーマットで記録してください。

### バグレポートテンプレート

```
## Bug ID: BUG-XXX
**優先度:** 高 / 中 / 低
**発見日:** YYYY-MM-DD
**ステータス:** 未対応 / 対応中 / 完了

### 概要
バグの概要を記載

### 再現手順
1. ステップ1
2. ステップ2
3. ステップ3

### 期待結果
期待される動作

### 実際の結果
実際の動作

### スクリーンショット
（必要に応じて）

### 環境
- OS: 
- ブラウザ: 
- バージョン: 
```

---

## テスト実施記録

各テストケースの実施結果を記録してください。

| Test ID | テスト名 | 実施日 | 結果 | 備考 |
|---------|----------|--------|------|------|
| TC-1.1.1 | 役職一覧の表示 | - | - | - |
| TC-1.1.2 | 役職の追加 | - | - | - |
| ... | ... | - | - | - |
